version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 20
    commands:
      - npm install  # Install project dependencies
      # Download and install Chrome
      - wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
      - sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'
      - sudo apt-get update && sudo apt-get install -y google-chrome-stable
      # Install Chromedriver
      - wget -N https://chromedriver.storage.googleapis.com/$(curl -sS https://chromedriver.storage.googleapis.com/LATEST_RELEASE)/chromedriver_linux64.zip
      - unzip chromedriver_linux64.zip
      - chmod +x chromedriver
      - sudo mv -f chromedriver /usr/local/bin/chromedriver

  pre_build:
    commands:
      # Start Chromedriver in headless mode
      - chromedriver --url-base=/wd/hub --port=4444 --headless --no-sandbox > /dev/null 2>&1 &
      # Wait for Chromedriver to start
      - sleep 5
      # Additional pre-build commands if needed

  build:
    commands:
      # Run Mocha tests with Mochawesome reporter
      - npm test

  post_build:
    commands:
      # Additional post-build commands if needed

artifacts:
  files:
    # Specify any files to be deployed as artifacts, if needed
